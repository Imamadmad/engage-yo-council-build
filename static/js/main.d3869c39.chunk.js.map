{"version":3,"sources":["mail.ts","Card.tsx","drawmap.tsx","SearchInput.tsx","map.tsx","serviceWorker.ts","index.tsx"],"names":["makeMailtoUri","data","encodeURI","mailAddress","encodeURIComponent","subject","body","Card","props","item","imgSrc","Link","Category","style","display","src","height","width","margin","marginTop","alt","href","target","Title","MailtoElement","Councilname","Fulldescription","mailtoDataAgree","Email","mailtoDataDisagree","rowToFeedbackItem","row","id","parseInt","Longitude","parseFloat","Latitude","Emailcontactname","Phonenumber","Surveylink","OpenUnderreviewclosed","processData","allRows","rowData","r","length","cell","val","col","push","drawmap","map","addControl","mapboxgl","NavigationControl","FullscreenControl","GeolocateControl","positionOptions","enableHighAccuracy","trackUserLocation","removeMarkers","markers","marker","remove","drawMarkers","points","filter","point","feedbackItem","popup","Popup","offset","setHTML","renderToString","markerOptions","color","Marker","setLngLat","setPopup","addTo","drawMarker","suggestedSearches","SearchInput","onSearchTermUpdated","useState","searchTerm","setSearchTerm","useEffect","type","onChange","e","value","suggestion","onClick","initialState","viewport","longitude","latitude","zoom","Map","state","updateViewport","setState","prevState","resize","window","innerHeight","inputChange","text","console","log","newFilteredPoints","toLowerCase","includes","filteredPoints","buttonClick","addEventListener","this","nextProps","nextState","removeEventListener","Promise","resolve","reject","fetch","then","res","json","result","spData","feed","entry","rows","feedbackItems","className","mapStyle","ref","getMap","mapboxApiAccessToken","onViewportChange","v","position","right","bottom","React","Boolean","location","hostname","match","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","error","message"],"mappings":"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","file":"static/js/main.d3869c39.chunk.js","sourcesContent":["export interface MailtoDataUnencoded {\n  mailAddress: string,\n  subject: string,\n  body: string\n}\n\nexport function makeMailtoUri(data: MailtoDataUnencoded) {\n  return `mailto:${encodeURI(data.mailAddress)}?subject=${encodeURIComponent(data.subject)}&body=${encodeURIComponent(data.body)}`;\n}\n","import React from 'react';\nimport { FeedbackItem } from './drawmap';\nimport { MailtoDataUnencoded, makeMailtoUri } from './mail';\n\ninterface Props {\n    item: FeedbackItem\n}\n\nexport default function Card(props: Props) {\n    const {item} = props;\n \n    let imgSrc = `https://s2.googleusercontent.com/s2/favicons?domain_url=${item.Link}`;\n    switch (item.Category) {\n        case 'park':\n          imgSrc= 'https://i.pinimg.com/originals/20/54/42/205442f452d956de1fae3d8fb7c90d10.png';\n          break;\n        case 'traffic':\n          imgSrc = 'https://img.icons8.com/android/24/000000/traffic-light.png';\n          break;\n        case 'cycle':\n          imgSrc ='https://img.icons8.com/cotton/64/000000/bicycle--v1.png';\n          break;\n        case 'retail':\n          imgSrc= 'https://img.icons8.com/pastel-glyph/64/000000/shop.png';\n          break;\n        case 'housing':\n          imgSrc = 'https://img.icons8.com/material-rounded/24/000000/cottage--v2.png'\n      }\n    \n    return (\n        <div>\n            <div style={{\n                display: 'flex',\n            }}>\n                <img \n                    src={imgSrc}\n                    height={20}\n                    width={20}\n                    style={{margin: '0px 4px', marginTop: 4}}\n                    alt=\"icon\"\n                />\n                <h2 style={{margin: 0, marginTop: 4}}><a href={item.Link} target=\"_blank\" >{item.Title}</a></h2>\n            </div>\n            <MailtoElement item={item} />\n            <p>{item.Councilname}</p>\n            <p>{item.Fulldescription}</p>\n        </div>\n    );\n}\n\nfunction MailtoElement(props: {item: FeedbackItem}) {\n  const item = props.item;\n  const mailtoDataAgree: MailtoDataUnencoded | null = item.Email ? {\n    mailAddress: item.Email,\n    subject: `Submission regarding ${item.Title || '<find the title on the council\\'s website>'}`,\n    body: `I'm emailing you to express my support for the proposal detailed at ${item.Link}.\\nReplace this line with your comments to personalise the message!`\n  } : null;\n  const mailtoDataDisagree: MailtoDataUnencoded | null = item.Email ? {\n    mailAddress: item.Email,\n    subject: `Submission regarding ${item.Title || '<find the title on the council\\'s website>'}`,\n    body: `I'm emailing you to express my disagreement with the proposal detailed at ${item.Link}.\\nReplace this line with your comments to personalise the message!`\n\n  } : null;\n  return mailtoDataAgree && mailtoDataDisagree\n       ? (<p>\n           <a href={makeMailtoUri(mailtoDataAgree)}>I agree \n            <img src=\"https://img.icons8.com/cotton/64/000000/thumb-up--v1.png\" height={12}/>\n           </a> / \n           <a href={makeMailtoUri(mailtoDataDisagree)}>I disagree \n            <img src=\"https://img.icons8.com/cotton/64/000000/thumbs-down--v4.png\" height={12}/>\n           </a>\n        </p>)\n       : null;\n}\n","import React from 'react';\nimport mapboxgl from 'mapbox-gl';\nimport { renderToString } from 'react-dom/server'\nimport Card from './Card';\n\nexport function getDataFromSheet(): Promise<any> {\n  return new Promise((resolve, reject) => {\n    const url = 'https://spreadsheets.google.com/feeds/cells/1EWTcF12D3xEDRzAFtX_xhxZKwmWHI-88pGmQGGsKYR0/1/public/values?alt=json';\n    fetch(url)\n      .then(res => res.json())\n      .then(result => {\n        resolve(result);\n      });\n  });\n}\n\nexport type SurveyStatus = 'Open' | 'Closed' | 'Under review';\n\nexport interface FeedbackItem {\n  id: number;\n  Latitude: number;\n  Longitude: number;\n  Councilname?: string;\n  Title?: string,\n  Link?: string,\n  Emailcontactname?: string;\n  Email?: string;\n  Phonenumber?: string;\n  Surveylink?: string\n  Fulldescription?: string\n  OpenUnderreviewclosed?: SurveyStatus\n  Category?: string;\n}\n\nexport function rowToFeedbackItem(row: string[]): FeedbackItem {\n  return {\n    id: parseInt(row[0]),\n    Councilname: row[1],\n    Longitude: parseFloat(row[2]),\n    Latitude: parseFloat(row[3]),\n    Title: row[4],\n    Link: row[5],\n    Emailcontactname: row[6],\n    Email: row[7],\n    Phonenumber: row[8],\n    Surveylink: row[9] === 'null' ? '' : row[9],\n    Fulldescription: row[10],\n    OpenUnderreviewclosed: row[11] as SurveyStatus, // YOLO\n    Category: row[12] || '',\n  }\n}\n\nexport function drawMarker(item: FeedbackItem, map: mapboxgl.Map): mapboxgl.Marker {\n  const { Title, Link, Latitude, Longitude, Category } = item;\n  var popup = new mapboxgl.Popup({ offset: 25 })\n    .setHTML(renderToString(\n      <Card item={item} />\n    ));\n\n  let markerOptions: {color?: string} = {};\n  switch (Category) {\n    case 'park':\n      markerOptions.color = 'green';\n      break;\n    case 'traffic':\n      markerOptions.color = 'grey';\n      break;\n    case 'cycle':\n      markerOptions.color ='red';\n      break;\n    case 'retail':\n      markerOptions.color = 'orange';\n      break;\n    case 'housing':\n      markerOptions.color = 'blue'\n  }\n\n  return new mapboxgl.Marker(markerOptions)\n    .setLngLat([Latitude, Longitude])\n    .setPopup(popup) // sets a popup on this marker\n    .addTo(map);\n}\n// Data is the spdata thing, returns list of things\nexport function processData(data: any): string[][] {\n  // var table = drawTable(parent);\n  let allRows = [];\n  var rowData = [];\n\n  for (var r = 0; r < data.length; r++) {\n    var cell = data[r][\"gs$cell\"];\n    var val = cell[\"$t\"];\n    if (cell.col == 1) {\n      // drawRow(table, rowData);\n      if (rowData[0] && rowData[0] != \"id\") {\n        allRows.push(rowData);\n      }\n      rowData = [];\n    }\n    rowData.push(val);\n  }\n  if (rowData[0] && rowData[0] != \"id\") {\n    allRows.push(rowData);\n  }\n  return allRows;\n}\n\nexport function drawmap(map: mapboxgl.Map): void {\n  map.addControl(new mapboxgl.NavigationControl());\n  map.addControl(new mapboxgl.FullscreenControl());\n  // Add geolocate control to the map.\n  map.addControl(new mapboxgl.GeolocateControl({\n    positionOptions: {\n      enableHighAccuracy: true\n    },\n    trackUserLocation: true\n  }));\n}\nexport function removeMarkers(markers: mapboxgl.Marker[]): void {\n  markers.map(marker => marker.remove());\n}\n\nexport function drawMarkers(map: mapboxgl.Map, points: FeedbackItem[]): mapboxgl.Marker[] {\n\n  // Draw demo marker\n  // const popup = new mapboxgl.Popup({ offset: 25 })\n  //   .setHTML(\"<h1>Dummy pop up cycleway!</h1><br><a href='https://www.surveymonkey.com/r/popupcycleways'>https://www.surveymonkey.com/r/popupcycleways</a></h1>\")\n  // .setText(\"test\")\n\n  // const marker = new mapboxgl.Marker()\n  //   .setLngLat([151.2093, -33.8688])\n  //   .setPopup(popup) // sets a popup on this marker\n  //   .addTo(map);\n\n  const markers = points\n    .filter(point => point.Latitude && point.Longitude)\n    .map((feedbackItem: FeedbackItem) => {\n      return drawMarker(feedbackItem, map);\n    });\n\n  return markers;\n}","import React, { FunctionComponent, useState, useEffect } from \"react\";\n\nconst suggestedSearches = [\"Cycle\", \"Park\", \"Zoning\", \"Traffic\"];\n\ntype SearchInputProps = {\n  onSearchTermUpdated: (term: string) => void;\n};\n\nexport const SearchInput: FunctionComponent<SearchInputProps> = ({ onSearchTermUpdated }) => {\n  const [searchTerm, setSearchTerm] = useState<string>(\"\");\n\n  useEffect(() => {\n    onSearchTermUpdated(searchTerm);\n  }, [searchTerm]);\n\n  const renderSearchSuggestions = () => {\n\n    return suggestedSearches.map((suggestion) => (\n      <button onClick={() => setSearchTerm(suggestion)}>{suggestion}</button>\n    ));\n  };\n\n  return (\n    <>\n      <div id=\"search_container\">\n        <h3>Search:</h3>\n        <input\n          type=\"text\"\n          onChange={(e) =>\n            setSearchTerm(e.target.value)\n          }\n          value={searchTerm}\n        />\n      </div>\n      <div id=\"search_suggestions\">{renderSearchSuggestions()}</div>\n    </>\n  );\n};\n","import * as React from \"react\";\nimport ReactMapGL, { NavigationControl } from \"react-map-gl\";\nimport mapboxgl from \"mapbox-gl\";\nimport \"./App.css\";\nimport { isCompositeComponent } from \"react-dom/test-utils\";\nimport {\n  drawmap,\n  FeedbackItem,\n  rowToFeedbackItem,\n  processData,\n  getDataFromSheet,\n  drawMarkers,\n  removeMarkers,\n} from \"./drawmap\";\nimport { SearchInput } from \"./SearchInput\";\n\nconst MAPBOX_TOKEN =\n  \"pk.eyJ1IjoiamFrZWMiLCJhIjoiY2tkaHplNGhjMDAyMDJybW4ybmRqbTBmMyJ9.AR_fnEuka8-cFb4Snp3upw\";\ninterface State {\n  viewport: {\n    longitude: number;\n    latitude: number; // starting position\n    zoom: number;\n    // height: number;\n    // width: number;\n  };\n  map?: mapboxgl.Map;\n  points?: FeedbackItem[];\n  markers?: mapboxgl.Marker[];\n  filteredPoints?: FeedbackItem[];\n}\nconst initialState: State = {\n  viewport: {\n    longitude: 151.2093,\n    latitude: -33.8688, // starting position\n    zoom: 13,\n    // height: 400,\n    // width: 400\n  },\n};\n\ntype Viewport = typeof initialState.viewport;\nexport class Map extends React.Component<{}, State> {\n  public state: State = initialState;\n\n  public componentDidMount() {\n    window.addEventListener(\"resize\", this.resize);\n    this.resize();\n  }\n\n  async UNSAFE_componentWillUpdate(nextProps: any, nextState: State) {\n    if (!nextState.map || !nextState.filteredPoints) {\n      return;\n    }\n    // If we haven't drawn any markers before, draw them AND the map\n    if (!this.state.markers && !nextState.markers) {\n      console.log(\"Initial draw of map\");\n      const { map, filteredPoints } = nextState;\n      drawmap(map);\n      const markers = drawMarkers(map, filteredPoints);\n      this.setState({\n        markers,\n      });\n    }\n    // If we HAVE drawn markers before, and the points are different, remove then draw them\n    if (\n      this.state.markers &&\n      this.state.filteredPoints !== nextState.filteredPoints\n    ) {\n      console.log(\"Redrawing markers\");\n      const { map, filteredPoints } = nextState;\n      removeMarkers(this.state.markers);\n      const markers = drawMarkers(map, filteredPoints);\n      this.setState({\n        markers,\n      });\n    }\n  }\n\n  public componentWillUnmount() {\n    window.removeEventListener(\"resize\", this.resize);\n  }\n\n  public async componentWillMount() {\n    const data = await getDataFromSheet();\n    const spData = data.feed.entry;\n    const rows = processData(spData);\n    console.log(\"All raw rows:\");\n    console.log({ rows });\n\n    const feedbackItems: FeedbackItem[] = rows.map(rowToFeedbackItem);\n    console.log({ feedbackItems });\n    this.setState({\n      points: feedbackItems,\n      // Initially, show all points\n      filteredPoints: feedbackItems,\n    });\n  }\n  public updateViewport = (viewport: Viewport) => {\n    this.setState((prevState) => ({\n      viewport: { ...prevState.viewport, ...viewport },\n    }));\n  };\n\n  public resize = () => {\n    this.setState((prevState) => ({\n      viewport: {\n        ...prevState.viewport,\n        height: window.innerHeight,\n        // width: window.innerWidth,\n      },\n    }));\n  };\n\n  private inputChange = (text: string) => {\n    // private inputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    // const text: string = e.target.value;\n    console.log({ text });\n\n    if (!this.state.points) {\n      return;\n    }\n\n    const newFilteredPoints = this.state.points.filter((point) =>\n      point.Title?.toLowerCase().includes(text.toLowerCase())\n    );\n\n    console.log(\"Length of ALL points:\", this.state.points.length);\n    console.log(\"Length of new filtered points:\", newFilteredPoints.length);\n\n    this.setState({\n      // Initially, show all points\n      filteredPoints: newFilteredPoints,\n    });\n  };\n  private buttonClick = (e: any) => {\n    if (this.state.markers) {\n      removeMarkers(this.state.markers);\n    }\n  };\n\n  public render() {\n    const { viewport } = this.state;\n    return (\n      <div id=\"container\">\n        <div id=\"search_overlay\">\n          <SearchInput onSearchTermUpdated={this.inputChange} />\n        </div>\n        <div id=\"map\">\n          <ReactMapGL\n            width={\"100%\"}\n            height={\"100%\"}\n            className={\"mapClass\"}\n            {...viewport}\n            mapStyle={\"mapbox://styles/mapbox/streets-v11\"}\n            ref={(ref) =>\n              ref && !this.state.map && this.setState({ map: ref.getMap() })\n            }\n            mapboxApiAccessToken={MAPBOX_TOKEN}\n            onViewportChange={(v: Viewport) => this.updateViewport(v)}\n          >\n            <div style={{ position: \"absolute\", right: 30, bottom: 30 }}>\n              <NavigationControl onViewportChange={this.updateViewport} />\n            </div>\n          </ReactMapGL>\n        </div>\n      </div>\n    );\n  }\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport {Map} from './map';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Map />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}