(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{24:function(e,t,n){e.exports=n(36)},29:function(e,t,n){},34:function(e,t,n){},36:function(e,t,n){"use strict";n.r(t);var a=n(2),i=n.n(a),o=n(16),r=n.n(o),s=(n(29),n(8)),c=n.n(s),l=n(14),u=n(10),m=n(17),p=n(18),d=n(23),h=n(21),f=n(15),g=(n(34),n(6)),v=n.n(g),w=n(20);function b(e){return"mailto:".concat(encodeURI(e.mailAddress),"?subject=").concat(encodeURIComponent(e.subject),"&body=").concat(encodeURIComponent(e.body))}function E(e){var t=e.item;t.Email&&(t.Email,"Submission regarding ".concat(t.Title||"<find the title on the council's website>"),"I'm email to express my support for the proposal detailed at ".concat(t.Link)),t.Email&&(t.Email,"Submission regarding ".concat(t.Title||"<find the title on the council's website>"),"I'm email to express my disagreement with the proposal detailed at ".concat(t.Link));return i.a.createElement("div",null,i.a.createElement("div",{style:{display:"flex"}},i.a.createElement("img",{src:"https://s2.googleusercontent.com/s2/favicons?domain_url=".concat(t.Link),height:16,width:16,style:{margin:6},alt:"icon"}),i.a.createElement("h2",{style:{margin:0}},i.a.createElement("a",{href:t.Link,target:"_blank"},t.Title))),i.a.createElement(y,{item:t}),i.a.createElement("p",null,"Council: ",t.Councilname),i.a.createElement("p",null,t.Fulldescription))}function y(e){var t=e.item,n=t.Email?{mailAddress:t.Email,subject:"Submission regarding ".concat(t.Title||"<find the title on the council's website>"),body:"I'm emailing you to express my support for the proposal detailed at ".concat(t.Link,".\nReplace this line with your comments to personalise the message!")}:null,a=t.Email?{mailAddress:t.Email,subject:"Submission regarding ".concat(t.Title||"<find the title on the council's website>"),body:"I'm emailing you to express my disagreement with the proposal detailed at ".concat(t.Link,".\nReplace this line with your comments to personalise the message!")}:null;return n&&a?i.a.createElement("p",null,i.a.createElement("a",{href:b(n)},"I agree \ud83d\udc4d\ud83c\udfff")," / ",i.a.createElement("a",{href:b(a)},"I disagree \ud83d\udc4e\ud83c\udffd")):null}function k(e){return{id:parseInt(e[0]),Councilname:e[1],Longitude:parseFloat(e[2]),Latitude:parseFloat(e[3]),Title:e[4],Link:e[5],Emailcontactname:e[6],Email:e[7],Phonenumber:e[8],Surveylink:e[9],Fulldescription:e[10],OpenUnderreviewclosed:e[11]}}function L(e){for(var t=[],n=[],a=0;a<e.length;a++){var i=e[a].gs$cell,o=i.$t;1==i.col&&(n[0]&&"id"!=n[0]&&t.push(n),n=[]),n.push(o)}return n[0]&&"id"!=n[0]&&t.push(n),t}function j(e){e.addControl(new v.a.NavigationControl),e.addControl(new v.a.FullscreenControl),e.addControl(new v.a.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}))}function C(e){e.map((function(e){return e.remove()}))}function S(e,t){return t.filter((function(e){return e.Latitude&&e.Longitude})).map((function(t){return function(e,t){e.Title,e.Link;var n=e.Latitude,a=e.Longitude,o=new v.a.Popup({offset:25}).setHTML(Object(w.renderToString)(i.a.createElement(E,{item:e})));return(new v.a.Marker).setLngLat([n,a]).setPopup(o).addTo(t)}(t,e)}))}var x=n(22),O=["Cycle","Park","Zoning","Traffic"],T=function(e){var t=e.onSearchTermUpdated,n=Object(a.useState)(""),o=Object(x.a)(n,2),r=o[0],s=o[1];Object(a.useEffect)((function(){t(r)}),[r]);return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{id:"search_container"},i.a.createElement("h3",null,"Search:"),i.a.createElement("input",{type:"text",onChange:function(e){return s(e.target.value)},value:r})),i.a.createElement("div",{id:"search_suggestions"},O.map((function(e){return i.a.createElement("button",{onClick:function(){return s(e)}},e)}))))},I={viewport:{longitude:151.2093,latitude:-33.8688,zoom:13}},A=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(m.a)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state=I,e.updateViewport=function(t){e.setState((function(e){return{viewport:Object(u.a)(Object(u.a)({},e.viewport),t)}}))},e.resize=function(){e.setState((function(e){return{viewport:Object(u.a)(Object(u.a)({},e.viewport),{},{height:window.innerHeight})}}))},e.inputChange=function(t){if(console.log({text:t}),e.state.points){var n=e.state.points.filter((function(e){var n;return null===(n=e.Title)||void 0===n?void 0:n.includes(t)}));console.log("Length of ALL points:",e.state.points.length),console.log("Length of new filtered points:",n.length),e.setState({filteredPoints:n})}},e.buttonClick=function(t){e.state.markers&&C(e.state.markers)},e}return Object(p.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.resize),this.resize()}},{key:"UNSAFE_componentWillUpdate",value:function(){var e=Object(l.a)(c.a.mark((function e(t,n){var a,i,o,r,s,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.map&&n.filteredPoints){e.next=2;break}return e.abrupt("return");case 2:this.state.markers||n.markers||(console.log("Initial draw of map"),a=n.map,i=n.filteredPoints,j(a),o=S(a,i),this.setState({markers:o})),this.state.markers&&this.state.filteredPoints!==n.filteredPoints&&(console.log("Redrawing markers"),r=n.map,s=n.filteredPoints,C(this.state.markers),l=S(r,s),this.setState({markers:l}));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resize)}},{key:"componentWillMount",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,n,a,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,t){fetch("https://spreadsheets.google.com/feeds/cells/1EWTcF12D3xEDRzAFtX_xhxZKwmWHI-88pGmQGGsKYR0/1/public/values?alt=json").then((function(e){return e.json()})).then((function(t){e(t)}))}));case 2:t=e.sent,n=t.feed.entry,a=L(n),console.log("All raw rows:"),console.log({rows:a}),i=a.map(k),console.log({feedbackItems:i}),this.setState({points:i,filteredPoints:i});case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state.viewport;return a.createElement("div",{id:"container"},a.createElement("div",{id:"search_overlay"},a.createElement(T,{onSearchTermUpdated:this.inputChange})),a.createElement("div",{id:"map"},a.createElement(f.b,Object.assign({width:"100%",height:"100%",className:"mapClass"},t,{mapStyle:"mapbox://styles/mapbox/streets-v11",ref:function(t){return t&&!e.state.map&&e.setState({map:t.getMap()})},mapboxApiAccessToken:"pk.eyJ1IjoiamFrZWMiLCJhIjoiY2tkaHplNGhjMDAyMDJybW4ybmRqbTBmMyJ9.AR_fnEuka8-cFb4Snp3upw",onViewportChange:function(t){return e.updateViewport(t)}}),a.createElement("div",{style:{position:"absolute",right:30,bottom:30}},a.createElement(f.a,{onViewportChange:this.updateViewport})))))}}]),n}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(A,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[24,1,2]]]);
//# sourceMappingURL=main.e369a731.chunk.js.map